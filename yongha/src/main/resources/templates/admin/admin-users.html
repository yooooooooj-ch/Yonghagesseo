<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/admin-layout}">
<head>
<meta charset="UTF-8" />
<title>관리자 - 회원 목록</title>
<th:block layout:fragment="head">
	<link rel="stylesheet" th:href="@{/css/admin.css}">
</th:block>
<link rel="stylesheet" th:href="@{/css/admin.css}">
<style>
/* 관리자 페이지에서 마케팅 히어로/탭 전부 숨김(무조건) */
.site-top, .site-hero, .hero, .top-tabs, #pageHead, .page-head.header-hero,
	.logo-white-circle, .logo-gradient-glow {
	display: none !important;
}
</style>

</head>
<body>
	<main layout:fragment="content" class="admin-top-spacer">

		<!--   ✅ 상단 메뉴바 (드롭다운 없음) 
  <header class="admin-topbar" role="banner">
    <div class="atb-wrap">
       좌측: 로고 + 1차 메뉴 
      <div class="atb-left">
        <a href="/admin" class="atb-logo">
          <img src="/img/yongha-logo.png" alt="Yongha"/>
          <span>Yongha Admin</span>
        </a>
        <nav class="atb-nav" aria-label="Primary">
          <a th:href="@{/admin/users}"   class="atb-link" data-match="/admin/users">Users</a>
          <a th:href="@{/admin/banners}" class="atb-link" data-match="/admin/banners">Banners</a>
          <a th:href="@{/admin/stats}"   class="atb-link" data-match="/admin/stats">Stats</a>
          <a th:href="@{/support/faq}"   class="atb-link" data-match="/support/faq">Help</a>
        </nav>
      </div>

       가운데: CTA 
      <div class="atb-center">
        <button class="atb-cta" type="button"
                onclick="location.href='/admin/create'">Create</button>
      </div>

       우측: 검색 + 알림 + 아바타 
      <div class="atb-right">
        <form class="atb-search" th:action="@{/admin/search}" method="get">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M10 18a8 8 0 1 1 5.293-14.293A8 8 0 0 1 10 18Zm11 3-6-6"
                  fill="none" stroke="currentColor" stroke-width="2"/>
          </svg>
        <input type="search" name="q" placeholder="Search" aria-label="Search">
        </form>

        <button class="atb-icon" type="button" title="Notifications" aria-label="Notifications">
          <svg viewBox="0 0 24 24">
            <path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2Zm8-6V11a8 8 0 1 0-16 0v5l-2 2h20l-2-2Z"
                  fill="none" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>

        <img class="atb-avatar" src="/img/avatar-admin.png" alt="프로필">
      </div>
    </div>
  </header>
   /상단 메뉴바 

  <section class="admin-shell">

     Sidebar 
    <aside class="admin-sidebar" id="adminSidebar">
      <div class="as-head">
        <h3 class="as-title">관리자 메뉴</h3>
        <button class="as-close" id="sidebarClose" aria-label="사이드바 닫기">✕</button>
      </div>
      <nav class="as-nav">
        <a th:href="@{/admin/users}"   class="as-link" data-match="/admin/users"><span class="ic">👥</span> 회원 목록 & 조회</a>
        <a th:href="@{/admin/banners}" class="as-link" data-match="/admin/banners"><span class="ic">🖼️</span> 홍보 & 배너 업로드</a>
        <a th:href="@{/admin/stats}"   class="as-link" data-match="/admin/stats"><span class="ic">📊</span> 회원 관리 통계</a>
      </nav>
      <div class="as-foot"><small>© 2025 Yongha Admin</small></div>
    </aside>-->

		<!-- Main -->
		<div class="admin-main">

			<!-- ✅ 회원목록 소제목 + 검색 영역 (카드) -->
			<section class="member-head-card">
				<div class="mh-title">
					<h1>회원 목록 & 조회</h1>
					<p class="page-sub">회원 정보를 조회/검색하고 상태를 제어합니다.</p>
				</div>
				<form class="mh-filters" method="get" th:action="@{/admin/users}">
					<input class="input" type="search" id="kw" name="keyword" placeholder="이름, 이메일, 닉네임 검색" th:value="${keyword}">
					<!-- 유지 -->

					<select class="select" id="grade" name="grade">
						<option value="" th:selected="${grade == ''}">전체 타입</option>
						<option value="0" th:selected="${grade == '0'}">부모</option>
						<option value="1" th:selected="${grade == '1'}">자녀</option>
						<option value="2" th:selected="${grade == '2'}">관리자</option>
					</select> <select class="select" id="state" name="state">
						<option value="" th:selected="${state == ''}">전체 상태</option>
						<option value="on" th:selected="${state == 'on'}">on</option>
						<option value="off" th:selected="${state == 'off'}">off</option>
					</select>

					<!-- 페이지/사이즈 유지 -->
					<input type="hidden" name="size" th:value="${size}"> <input type="hidden" name="sortField" th:value="${sortField}"> <input type="hidden" name="sortDir" th:value="${sortDir}">

					<button class="btn" type="button" id="resetBtn" onclick="location.href='/admin/users'">초기화</button>
					<button class="btn primary" type="submit" id="searchBtn">검색</button>
				</form>
			</section>

			<!-- KPI -->
			<section class="kpi-wrap">
				<div class="kpi-grid">
					<article class="kpi-card">
						<div class="kpi-top">
							<span>👥 총 회원</span>
						</div>
						<div class="kpi-num" id="kpi-total" th:text="${userCount}"></div>
					</article>
					<article class="kpi-card">
						<div class="kpi-top">
							<span>💰 계좌 등록 회원</span>
						</div>
						<div class="kpi-num" id="kpi-ok" th:text="${accountCount} + '(' + ${accountPercent} + '% )'"></div>
					</article>
					<article class="kpi-card">
						<div class="kpi-top">
							<span>🧑🏻‍🍼 부모 회원</span>
						</div>
						<div class="kpi-num" id="kpi-hold" th:text="${parentCount}">1</div>
					</article>
					<article class="kpi-card">
						<div class="kpi-top">
							<span>👶 자녀 회원</span>
						</div>
						<div class="kpi-num" id="kpi-today" th:text="${childCount}">0</div>
					</article>
				</div>
			</section>

			<section>
				<!-- Bulk toolbar (checked rows) -->
				<div class="bulkbar" id="bulkBar" hidden>
					<div class="bb-left">
						<strong id="selCount">0</strong>개 선택됨
					</div>
					<div class="bb-right">
						<button class="btn">선택 해제</button>
						<button class="btn danger">선택 삭제</button>
					</div>
				</div>

				<!-- Table -->
				<div class="card table-wrap">
					<div class="table-meta">
						<div>
							<span id="resultCount" th:text="${resultCount}">2</span>건
						</div>
					</div>

					<table class="tbl" id="userTable">
						<thead>
							<tr>
								<th style="width: 48px;"><input type="checkbox" id="checkAll"></th>

								<!-- 정렬 가능한 헤더는 a 링크로 -->
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='user_no',
								          sortDir=${sortField=='user_no' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">회원번호</a></th>
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='user_id',
								          sortDir=${sortField=='user_id' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">아이디</a></th>
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='user_name',
								          sortDir=${sortField=='user_name' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">이름</a></th>
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='email',
								          sortDir=${sortField=='email' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">이메일</a></th>
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='user_type',
								          sortDir=${sortField=='user_type' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">타입</a></th>
								<th><a th:href="@{/admin/users(
								          page=${page},
								          size=${size},
								          keyword=${keyword},
								          grade=${grade},
								          state=${state},
								          sortField='birthday',
								          sortDir=${sortField=='birthday' && sortDir=='asc' ? 'desc' : 'asc'}
								      )}">생년월일</a></th>
								<th>알람설정</th>
								<th style="width: 120px;">액션</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="row : ${users}" th:attr="data-user-no=${row.user_no}">
								<td><input type="checkbox" class="row-check" th:value="${row.user_no}"></td>
								<td th:text="${row.user_no}"></td>
								<td th:text="${row.user_id}"></td>
								<td th:text="${row.user_name}"></td>
								<td th:text="${row.email}"></td>
								<td class="grade"><span th:each="c : ${USER_TYPE_CODES}" th:if="${c.value == row.user_type}" th:text="${c.label}">🔖</span></td>
								<td th:text="${row.birthday}"></td>
								<td class="state" th:text="${row.fcm_token}!=null ? 'on' : 'off'"></td>
								<td class="row-actions">
									<button class="btn danger">삭제</button>
								</td>
							</tr>
						</tbody>
					</table>


					<!-- Pagination -->
					<div class="pager" th:if="${total > 0}">
						<a class="btn ghost" th:if="${page > 0}" th:href="@{/admin/users(
					         page=${page-1},
					         size=${size},
					         keyword=${keyword},
					         grade=${grade},
					         state=${state},
					         sortField=${sortField},
					         sortDir=${sortDir}
					     )}">이전</a> <span th:text="${displayPage}">1</span> / <span th:text="${totalPages}">1</span> <a class="btn ghost" th:if="${page + 1 < totalPages}" th:href="@{/admin/users(
					         page=${page+1},
					         size=${size},
					         keyword=${keyword},
					         grade=${grade},
					         state=${state},
					         sortField=${sortField},
					         sortDir=${sortDir}
					     )}">다음</a>
					</div>
				</div>
			</section>
		</div>


		<script th:src="@{/js/admin.js}"></script>

		<!-- 상단 메뉴 활성화 & 검색 엔터 제출 (필수) -->
		<script>
    (function(){
      const now = location.pathname.toLowerCase();
      document.querySelectorAll('.atb-link').forEach(a=>{
        const m = (a.getAttribute('data-match') || a.getAttribute('href') || '').toLowerCase();
        if(m && now.startsWith(m)) a.classList.add('active');
      });
      document.querySelector('.atb-search input')?.addEventListener('keydown', e=>{
        if(e.key === 'Enter'){ e.target.form?.submit(); }
      });
    })();
  </script>

	</main>
</body>
</html>