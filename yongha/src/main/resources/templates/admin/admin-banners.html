<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}">

<head>
  <meta charset="UTF-8" />
  <title>ê´€ë¦¬ì - ë°°ë„ˆ ì—…ë¡œë“œ</title>
  <th:block layout:fragment="head">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/banner.css}">
    <style>
      /* âœ… ì—…ë¡œë” ì˜ì—­ 2ì—´ ë°°ì¹˜ */
      .uploader-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* ì¢Œì¸¡: ì´ë¯¸ì§€, ìš°ì¸¡: ì…ë ¥ í¼ */
        gap: 24px;
        align-items: start;
      }
      .uploader-grid .drop {
        height: 100%;
        min-height: 260px;
      }
      .up-right {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 16px;
      }
      .up-right .form-actions {
        text-align: right;
        margin-top: auto; /* ë²„íŠ¼ì„ í•˜ë‹¨ìœ¼ë¡œ */
      }
    </style>
  </th:block>
</head>

<body>
  <main layout:fragment="content">

    <!-- âœ… ë©”ì¸ -->
    <div class="admin-main banners-page">

      <!-- ìƒë‹¨ ì¹´ë“œ(ì œëª©) -->
      <section class="member-head-card">
        <div class="mh-title">
          <h1>í™ë³´ & ë°°ë„ˆ ì—…ë¡œë“œ</h1>
          <p class="page-sub">í™ˆ/íˆì–´ë¡œ ì˜ì—­ì— ë…¸ì¶œë  ë°°ë„ˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</p>
        </div>
      </section>

      <!-- ì—…ë¡œë” ì¹´ë“œ -->
      <div class="card uploader">
        <form id="bannerForm" enctype="multipart/form-data" method="post" action="/saveBanner">

          <!-- ì¢Œ/ìš° ê·¸ë¦¬ë“œ -->
          <div class="uploader-grid">
            <!-- ì¢Œì¸¡: ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
            <div class="field">
              <label>ë°°ë„ˆ ì´ë¯¸ì§€</label>
              <div class="drop" id="dropZone" aria-live="polite">
                <div id="dropContent" class="empty" style="text-align:center;">
                  <div id="bn-file-trigger" class="bn-file clickable" style="font-size:28px"
                       role="button" tabindex="0" aria-label="ë°°ë„ˆ ì´ë¯¸ì§€ ì„ íƒ">ğŸ–¼ï¸</div>
                  <div class="help">íŒŒì¼ì„ ëŒì–´ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                </div>
                <input type="file" name="image" id="bn-file-input" accept="image/*" hidden required>
              </div>
            </div>

            <!-- ìš°ì¸¡: ì…ë ¥ í•„ë“œ + ë“±ë¡ë²„íŠ¼ -->
            <div class="up-right">
              <div>
                <div class="field-row">
                  <div class="field">
                    <label>ì‹œì‘ì¼</label>
                    <input type="datetime-local" name="startDate" id="startDate" required>
                  </div>
                  <div class="field">
                    <label>ì¢…ë£Œì¼</label>
                    <input type="datetime-local" name="endDate" id="endDate" required>
                  </div>
                </div>

                <div class="field">
                  <label for="bannerIndex">í‘œì‹œí•  í˜ì´ì§€</label>
                  <input type="number" name="bannerIndex" id="bannerIndex" min="1" max="9" required>
                </div>
              </div>

              <!-- ë²„íŠ¼ (ìš°ì¸¡ í•˜ë‹¨ ê³ ì •) -->
              <div class="form-actions">
                <button type="submit" class="btn primary">ë“±ë¡</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- âœ… ìµœê·¼ ë“±ë¡ëœ ë°°ë„ˆ ì¹´ë“œí˜• ë¦¬ìŠ¤íŠ¸ -->
    <div class="card">
      <h3 class="banner-list-title">ìµœê·¼ ë“±ë¡ëœ ë°°ë„ˆ</h3>
      <div class="banner-list">

        <div class="banner-card" th:each="b : ${banners}">
          <!-- ì´ë¯¸ì§€ -->
          <img th:src="@{${b.imgPath}}" alt="ë°°ë„ˆ ì´ë¯¸ì§€">

          <!-- ì •ë³´ -->
          <div class="banner-info">
            <strong th:text="'ë°°ë„ˆ #' + ${b.bannerNo}"></strong>
            <span th:text="'ì‹œì‘ì¼: ' + ${#dates.format(b.startDate, 'yyyy-MM-dd HH:mm')}"></span>
            <span th:text="'ì¢…ë£Œì¼: ' + ${#dates.format(b.endDate, 'yyyy-MM-dd HH:mm')}"></span>

            <!-- ìƒíƒœì¹© -->
            <span class="status-chip"
                  th:classappend="${bannerStatusMap[b.bannerNo] == 'ê²Œì‹œ ì „'} ? ' upcoming' 
                                  : (${bannerStatusMap[b.bannerNo] == 'ë§Œë£Œ'} ? ' expired' : ' active')"
                  th:text="${bannerStatusMap[b.bannerNo]}">
            </span>
          </div>

          <!-- ì•¡ì…˜ -->
          <div class="banner-actions">
            	<button type="button" class="btn-delete" th:data-id="${b.bannerNo}">ì‚­ì œ</button>
          </div>
        </div>

      </div>
    </div>

    </section>
    <script th:src="@{/js/admin.js}"></script>
    <script th:src="@{/js/upload_banner.js}"></script>

    <!-- âœ… ì‚­ì œ ë²„íŠ¼ ë™ì‘ (DOMë§Œ ì‚­ì œ) -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".btn-delete").forEach(btn => {
    btn.addEventListener("click", function () {
      const bannerNo = this.getAttribute("data-id");
      if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

      fetch("/deleteBanner", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "bannerNo=" + encodeURIComponent(bannerNo)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          this.closest(".banner-card").remove(); // âœ… ì¦‰ì‹œ í™”ë©´ì—ì„œ ì œê±°
        } else {
          alert("ì‚­ì œ ì‹¤íŒ¨: " + (data.message || ""));
        }
      })
      .catch(err => {
        console.error(err);
        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
    });
  });
});
</script>

  </main>
</body>
</html>
