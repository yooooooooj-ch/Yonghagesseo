<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/admin-layout}">
<head>
<meta charset="UTF-8" />
<title>ê´€ë¦¬ì - í†µê³„</title>

<!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
<th:block layout:fragment="head">
	<link rel="stylesheet" th:href="@{/css/admin.css}">
</th:block>
<link rel="stylesheet" th:href="@{/css/admin.css}">

<style>
/* ë§ˆì¼€íŒ… íˆì–´ë¡œ/íƒ­ ì „ë¶€ ìˆ¨ê¹€ */
.site-top, .site-hero, .hero, .top-tabs, #pageHead, .page-head.header-hero,
	.logo-white-circle, .logo-gradient-glow {
	display: none !important;
}

:root {
	/* ì°¨íŠ¸ íŒ”ë ˆíŠ¸ */
	--c-blue: #3b82f6;
	--c-indigo: #6366f1;
	--c-emerald: #10b981;
	--c-amber: #f59e0b;
	--c-slate: #94a3b8;
}

/* KPI í†¤ë§Œ ì‚´ì§ ê°•í™” */
.kpi-grid.kpi-stats {
	gap: 12px;
}

.kpi-card {
	position: relative;
	overflow: hidden;
}

.kpi-card::after {
	content: "";
	position: absolute;
	right: -28px;
	bottom: -28px;
	width: 140px;
	height: 140px;
	border-radius: 50%;
	opacity: .14;
	filter: blur(2px);
}

.kpi-card.soft-blue {
	background: linear-gradient(180deg, #f5f8ff, #ffffff);
}

.kpi-card.soft-indigo {
	background: linear-gradient(180deg, #f7f5ff, #ffffff);
}

.kpi-card.soft-emerald {
	background: linear-gradient(180deg, #f5fffb, #ffffff);
}

.kpi-card.soft-amber {
	background: linear-gradient(180deg, #fff9e8, #ffffff);
}

.kpi-card.soft-blue::after {
	background: var(--c-blue);
}

.kpi-card.soft-indigo::after {
	background: var(--c-indigo);
}

.kpi-card.soft-emerald::after {
	background: var(--c-emerald);
}

.kpi-card.soft-amber::after {
	background: var(--c-amber);
}

/* ì°¨íŠ¸ ë ˆì´ì•„ì›ƒ */
.stats-graphs.pretty .chart-row-2 {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  margin-bottom: 12px; /* ì¤„ ê°„ê²© */
}

.stats-graphs.pretty .chart-card {
  background: #fff;
  border: 1px solid var(--ad-line);
  border-radius: 12px;
  padding: 12px;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
}

.stats-graphs.pretty .chart-title {
  font-weight: 900;
  color: #0b4e74;
  margin: 4px 0 10px;
  display: flex;
  gap: 8px;
  align-items: baseline;
}

.stats-graphs.pretty .chart-canvas {
  height: 260px; /* ì›ê·¸ë˜í”„/ë§‰ëŒ€ ë™ì¼ ë†’ì´ */
  position: relative;
}

.chart-canvas canvas {
  width: 100% !important;
  height: 100% !important;
  display: block;
}

/* ë°˜ì‘í˜•: í•œ ì—´ë¡œ ìŒ“ê¸° */
@media (max-width: 1024px) {
  .stats-graphs.pretty .chart-row-2 {
    grid-template-columns: 1fr;
  }
}


.legend-subline {
	margin-top: 6px;
	text-align: center;
	font-size: 12px;
	font-weight: 600;
	color: #334155;
}

/* ìƒë‹¨ í•„í„° ì „ì²´ ì»¨í…Œì´ë„ˆ */
.mh-filters {
	display: flex !important;
	flex-direction: column;
}

.mh-filters .filter-row {
	width: 70% !important;
	display: flex;
	justify-content: space-between; /* ì¢Œ/ìš° ëìœ¼ë¡œ ë°°ì¹˜ */
	align-items: center;
	gap: 12px;
}

.date-group {
	display: flex;
	align-items: center;
	gap: 6px; /* ë¼ë²¨ê³¼ input ì‚¬ì´ ì—¬ë°± */
	flex: 1; /* í•„ìš”ì‹œ ê· ë“± í­ */
}

.mh-filters .action-row {
	width: 70% !important;
	display: flex;
	justify-content: center; /* ê°€ë¡œì¶• ê°€ìš´ë° */
	gap: 12px; /* ìš”ì†Œ ê°„ ê°„ê²© */
}

.mh-filters .action-row .btn {
	flex: 0 0 auto; /* ìë™ ëŠ˜ì–´ë‚¨ ë°©ì§€ */
	min-width: 100px; /* ìµœì†Œ ë„ˆë¹„ */
	width: 100px; /* ëª¨ë“  ë²„íŠ¼ ë™ì¼ í­ */
	text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
}

</style>
</head>

<body>
	<main layout:fragment="content">
		<div class="admin-main">

			<!-- ìƒë‹¨ ì¹´ë“œ(ì œëª© + ê¸°ê°„ í•„í„°) -->
			<section class="member-head-card">
				<div class="mh-title">
					<h1>íšŒì› ê´€ë¦¬ í†µê³„</h1>
					<p class="page-sub">ê¸°ê°„ë³„ ê°€ì… í˜„í™©ê³¼ ìƒíƒœ ë¶„í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
				</div>
				<div class="mh-filters">
					<div class="filter-row">
						<div class="date-group">
							<span class="date-label">ì‹œì‘ì¼</span> <input class="input" type="date" id="fromDate" name="fromDate" th:value="${fromDate}">
						</div>
						<div class="date-group">
							<span class="date-label">ì¢…ë£Œì¼</span> <input class="input" type="date" id="toDate" name="toDate" th:value="${toDate}">
						</div>
					</div>
					<div class="action-row">
						<button class="btn" id="btnThisMonth">ì´ë²ˆ ë‹¬</button>
						<button class="btn" id="btn3m">3ê°œì›”</button>
						<button class="btn" id="btn6m">6ê°œì›”</button>
						<button class="btn" id="btn12m">1ë…„</button>
						<button class="btn" id="btnReset" type="button">ì´ˆê¸°í™”</button>
						<button class="btn primary" id="btnFetch">ì¡°íšŒ</button>
					</div>
				</div>
			</section>

			<!-- KPI 4ì¥ -->
			<section class="kpi-wrap">
				<div class="kpi-grid kpi-stats">
					<article class="kpi-card soft-blue">
						<div class="kpi-top">
							<span>ğŸ‘¥ ì´ ê°€ì… ê³„ì • ìˆ˜</span>
						</div>
						<div class="kpi-num" id="kpi-total">12,430</div>
						<div class="help">
							ì§€ë‚œë‹¬ ëŒ€ë¹„ <strong id="kpi-total-percent">+3.1%</strong>
						</div>
					</article>

					<article class="kpi-card soft-indigo">
						<div class="kpi-top">
							<span>ğŸ§‘â€ğŸ¼ ë¶€ëª¨ ê³„ì • ìˆ˜</span>
						</div>
						<div class="kpi-num" id="kpi-parents">6,460</div>
						<div class="help">
							ë¹„ì¤‘ <strong id="kpi-parents-percent">52%</strong>
						</div>
					</article>

					<article class="kpi-card soft-emerald">
						<div class="kpi-top">
							<span>ğŸ§’ ìë…€ ê³„ì • ìˆ˜</span>
						</div>
						<div class="kpi-num" id="kpi-children">5,970</div>
						<div class="help">
							ë¹„ì¤‘ <strong id="kpi-children-percent">48%</strong>
						</div>
					</article>

					<article class="kpi-card soft-amber">
						<div class="kpi-top">
							<span>ğŸ’¸ í”Œë«í¼ ì¼ í‰ê·  ì´ì²´ ìˆ˜</span>
						</div>
						<div class="kpi-num" id="kpi-dailyTransfers">2,340</div>
						<div class="help" id="kpi-dailyTransfers-text">ìµœê·¼ 30ì¼ í‰ê· </div>
					</article>
				</div>
			</section>

			<!-- ì°¨íŠ¸: ë¯¸ë‹ˆ ë„ë„› 4ê°œ + ìš°ì¸¡ ë‘ ê°œ ë§‰ëŒ€ -->
			<section class="card stats-graphs pretty">
				<div class="stats-head">
					<h2>ê°€ì… ë¶„í¬ & ì„ í˜¸</h2>
				</div>
				
				<!-- ë§‰ëŒ€ê·¸ë˜í”„ 2ê°œ -->
				<div class="chart-row-2">
					<article class="chart-card">
						<div class="chart-title">ìë…€ ì—°ë ¹ëŒ€ ë¶„í¬</div>
						<div class="chart-canvas">
							<canvas id="chAge"></canvas>
						</div>
					</article>
					<article class="chart-card">
						<div class="chart-title">ìë…€ ì—°ë ¹ëŒ€ ì†Œë¹„ í‰ê· </div>
						<div class="chart-canvas">
							<canvas id="chAvgCons"></canvas>
						</div>
					</article>
				</div>

				<!-- ì›ê·¸ë˜í”„ 4ê°œ -->
				<div class="chart-row-2">
					<article class="chart-card">
						<div class="chart-title">ë“±ë¡ëœ ëª©í‘œ ì¹´í…Œê³ ë¦¬ ì„ í˜¸</div>
						<div class="chart-canvas">
							<canvas id="chPref"></canvas>
						</div>
					</article>
					<article class="chart-card">
						<div class="chart-title">ëª©í‘œ ë‹¬ì„±ê¸°ê°„ ë¹„ìœ¨</div>
						<div class="chart-canvas">
							<canvas id="chAchieved"></canvas>
						</div>
					</article>
				</div>
				<div class="chart-row-2">
					<article class="chart-card">
						<div class="chart-title">ë¶€ëª¨ ê°€ì… ë¶„í¬</div>
						<div class="chart-canvas">
							<canvas id="chSignupParents"></canvas>
						</div>
					</article>
					<article class="chart-card">
						<div class="chart-title">ìë…€ ê°€ì… ë¶„í¬</div>
						<div class="chart-canvas">
							<canvas id="chSignupChildren"></canvas>
						</div>
					</article>
				</div>

				
			</section>
		</div>

		<!-- ê³µí†µ JS -->
		<script th:src="@{/js/admin.js}"></script>

		<!-- Chart.js CDN -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

		<script th:inline="javascript">
		    /* ---------- ê³µí†µ ìœ í‹¸ ---------- */
		    const $css = getComputedStyle(document.documentElement);
		    const cssVar = (k, fallback='') => ($css.getPropertyValue(k)||fallback).trim();
		    const HEX = (h,a=1)=>{ // '#rrggbb' -> rgba(...)
		      const c=h.replace('#',''); const r=parseInt(c.substr(0,2),16), g=parseInt(c.substr(2,2),16), b=parseInt(c.substr(4,2),16);
		      return `rgba(${r},${g},${b},${a})`;
		    };
		
		    /* ---------- íŒŒìŠ¤í…” ë¸”ë£¨ íŒ”ë ˆíŠ¸ ---------- */
		    const BLUE = {
		      main:  cssVar('--chart-primary','#3E6FEF'),
		      strong:cssVar('--chart-primary-strong','rgba(62,111,239,.90)'),
		      soft:  cssVar('--chart-soft','rgba(143,178,255,.30)'),
		      grid:  cssVar('--chart-grid','rgba(62,111,239,.16)'),
		      step400: cssVar('--cb-400','#8FB2FF'),
		      step500: cssVar('--cb-500','#5D90F6'),
		      step600: cssVar('--cb-600','#3E6FEF'),
		      step700: cssVar('--cb-700','#2F58D8'),
		    };
		
		    const RAMP_SOFT2DEEP = [
		      'rgba(143,178,255,.28)',  // very soft
		      'rgba(143,178,255,.44)',
		      'rgba(93,144,246,.66)',
		      'rgba(62,111,239,.85)',
		      BLUE.strong              // almost solid
		    ];
		
		    /* ---------- ë„ë„› ê³µí†µ(ë¸”ë£¨) ---------- */
		    function miniDonut(canvasId, value, total, colorHex, outTextId){
		      const el = document.getElementById(canvasId);
		      const pct = Math.round((value/total)*100);
		      if (outTextId) { const t=document.getElementById(outTextId); if(t) t.textContent=pct+'%'; }
		
		      new Chart(el, {
		        type: 'doughnut',
		        data: {
		          labels: ['ê°’','ë‚˜ë¨¸ì§€'],
		          datasets: [{
		            data: [value, Math.max(total - value, 0)],
		            backgroundColor: [
		              colorHex || BLUE.strong,   // ê°’
		              BLUE.soft                  // ë‚˜ë¨¸ì§€
		            ],
		            borderWidth: 0,
		            hoverOffset: 2
		          }]
		        },
		        options: {
		          responsive:true, maintainAspectRatio:false,
		          cutout: '78%',
		          plugins: { legend:{display:false}, tooltip:{enabled:false} }
		        },
		        plugins: [{
		          id:'centerMini',
		          afterDraw(chart){
		            const {ctx, chartArea:{width, height}} = chart;
		            ctx.save();
		            ctx.font = '700 16px system-ui,-apple-system,Segoe UI,Roboto';
		            ctx.fillStyle = BLUE.step700;   // ì§„ë¸”ë£¨ í…ìŠ¤íŠ¸
		            ctx.textAlign = 'center';
		            ctx.textBaseline = 'middle';
		            ctx.fillText(pct + '%', width/2, height/2);
		            ctx.restore();
		          }
		        }]
		      });
		    }
		    
		    /* ---------- ë©€í‹° ë„ë„›(ë¼ë²¨/ê°’ ë°°ì—´ + ì¤‘ì•™ í¼ì„¼íŠ¸) ---------- */
		    function multiDonutWithCenter(canvasId, labels, values, colors) {
			  const el = document.getElementById(canvasId);
			  if (!el || !labels || !labels.length) return;
			
			  const vals = values.map(v => Number(v) || 0);
			  const sum  = vals.reduce((a,b)=>a+b, 0);
			  const pct  = sum > 0 ? vals.map(v => (v / sum) * 100) : vals.map(() => 0);
			
			  let maxIdx = 0;
			  for (let i = 1; i < vals.length; i++) if (vals[i] > vals[maxIdx]) maxIdx = i;
			
			  const centerState = {
			    label: labels[maxIdx] || '',
			    pct:   Math.round(pct[maxIdx] || 0)
			  };
			
			  const bg = (colors || []).slice(0, labels.length);
			  while (bg.length < labels.length) bg.push(BLUE.strong);
			
			  return new Chart(el, {
			    type: 'doughnut',
			    data: { labels, datasets: [{ data: vals, backgroundColor: bg, borderWidth: 0, hoverOffset: 2 }] },
			    options: {
			      responsive: true,
			      maintainAspectRatio: false,
			      cutout: '60%',
			      plugins: {
			        legend: { display: true, position: 'bottom', labels: { boxWidth: 12, font: { weight: 600 } } },
			        tooltip: {
			          enabled: true,
			          backgroundColor:'#0b1020',
			          padding:10,
			          titleColor:'#fff',
			          bodyColor:'#e5e7eb',
			          callbacks: {
			            label: (ctx) => {
			              const i = ctx.dataIndex;
			              const count = vals[i];
			              const p = Math.round(pct[i] || 0);
			              return `${ctx.label}: ${fmt(count)}ê±´ (${p}%)`;
			            }
			          }
			        }
			      }
			    },
			    plugins: [{
			      id: 'centerForMulti',
			      afterEvent(chart) {
			        const act = chart.getActiveElements();
			        if (act && act.length) {
			          const i = act[0].index;
			          centerState.label = labels[i];
			          centerState.pct   = Math.round(pct[i] || 0);
			        } else {
			          centerState.label = labels[maxIdx] || '';
			          centerState.pct   = Math.round(pct[maxIdx] || 0);
			        }
			        chart.draw();
			      },
			      afterDraw(chart) {
			        const { ctx, chartArea } = chart;
			        const cx = (chartArea.left + chartArea.right) / 2;
			        const cy = (chartArea.top + chartArea.bottom) / 2;
			
			        ctx.save();
			        ctx.textAlign = 'center';
			        ctx.textBaseline = 'middle';
			
			        // ìƒë‹¨ ë¼ë²¨
			        ctx.font = '600 12px system-ui,-apple-system,Segoe UI,Roboto';
			        ctx.fillStyle = '#64748b';
			        ctx.fillText(centerState.label, cx, cy - 12);
			
			        // í•˜ë‹¨ í¼ì„¼íŠ¸
			        ctx.font = '700 18px system-ui,-apple-system,Segoe UI,Roboto';
			        ctx.fillStyle = BLUE.step700;
			        ctx.fillText(centerState.pct + '%', cx, cy + 10);
			
			        ctx.restore();
			      }
			    }]
			  });
			}
		    
		    /* ë‚ ì§œ ìœ í‹¸ */
		    function fmtDate(d){
		      const y = d.getFullYear();
		      const m = String(d.getMonth()+1).padStart(2,'0');
		      const day = String(d.getDate()).padStart(2,'0');
		      return `${y}-${m}-${day}`;
		    }
		    function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
		    function addMonths(d, delta){ const nd = new Date(d); nd.setMonth(nd.getMonth() + delta); return nd; }

		    // ì›” ê²½ê³„ ê¸°ì¤€ ìœˆë„ìš°: (í˜„ì¬ì›” í¬í•¨ Nê°œì›”) â†’ from = (í˜„ì¬ë‹¬ 1ì¼)ì—ì„œ (N-1)ê°œì›” ì „ 1ì¼, to = ì˜¤ëŠ˜
		    function setRangeLastNMonthsInclusive(n){
		      const today = new Date();
		      const cur1st = startOfMonth(today);
		      const from1st = startOfMonth(addMonths(cur1st, -(n-1)));
		      document.getElementById("fromDate").value = fmtDate(from1st);
		      document.getElementById("toDate").value   = fmtDate(today);
		    }
		    function setRangeThisMonth(){
		      const today = new Date();
		      document.getElementById("fromDate").value = fmtDate(startOfMonth(today));
		      document.getElementById("toDate").value   = fmtDate(today);
		    }

		    /* ë°”ì¸ë”© */
		    document.getElementById("btnThisMonth").addEventListener("click", () => {
		      setRangeThisMonth();
		      document.getElementById("btnFetch").click();
		    });
		    document.getElementById("btn3m").addEventListener("click", () => {
		      setRangeLastNMonthsInclusive(3);
		      document.getElementById("btnFetch").click();
		    });
		    document.getElementById("btn6m").addEventListener("click", () => {
		      setRangeLastNMonthsInclusive(6);
		      document.getElementById("btnFetch").click();
		    });
		    document.getElementById("btn12m").addEventListener("click", () => {
		      setRangeLastNMonthsInclusive(12);
		      document.getElementById("btnFetch").click();
		    });
		    document.getElementById("btnReset").addEventListener("click", () => {
	    	  document.getElementById("fromDate").value = "";
	    	  document.getElementById("toDate").value   = "";
	    	  document.getElementById("btnFetch").click();
	    	});
		    
		    document.getElementById("btnFetch").addEventListener("click", () => {
		    	const from = document.getElementById("fromDate").value;
		        const to   = document.getElementById("toDate").value;

		        // ê¸°ë³¸ ê²€ì¦
		        if (from && to && new Date(from) > new Date(to)) {
		          showAlert({ title: 'ì•Œë¦¼', text: "ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", icon: 'warning' });
		          return;
		        }

		        // URL êµ¬ì„± (Spring Controller: /stats?fromDate=...&toDate=...)
		        const params = new URLSearchParams();
		        if (from) params.append("fromDate", from);
		        if (to)   params.append("toDate", to);

		        window.location.href = "/admin/stats" + (params.toString() ? "?" + params.toString() : "");
		      });
		
		    /* ----------   ë°ì´í„° (ê·¸ëŒ€ë¡œ)   ---------- */
		    const PARENTS     = /*[[${parents}]]*/ 0;
		    const CHILDREN        = /*[[${children}]]*/ 0;
		    const TOTAL_USERS = /*[[${totalUser}]]*/ 0;
		    const JOIN_PERCENT= /*[[${joinPercent}]]*/ 0;
		    const DAILY_TRANSFER= /*[[${avgTransfer}]]*/ 0;
		    
		    /* ---------- ìƒ˜í”Œ ë°ì´í„° (ê·¸ëŒ€ë¡œ) ---------- */
		    const AGE_LABELS  = ['6â€“8','9â€“12','13â€“15', '16-18'];
		    const AGE_VALUES  = [
		        /*[[${ageGroups.AGE_6_8} ?: 0]]*/ 0,
		        /*[[${ageGroups.AGE_9_12} ?: 0]]*/ 0,
		        /*[[${ageGroups.AGE_13_15} ?: 0]]*/ 0,
		        /*[[${ageGroups.AGE_16_18} ?: 0]]*/ 0
		    	];
		    const AVG_CONS_VALUES  = [
		        /*[[${avgCons.AGE_6_8} ?: 0]]*/ 0,
		        /*[[${avgCons.AGE_9_12} ?: 0]]*/ 0,
		        /*[[${avgCons.AGE_13_15} ?: 0]]*/ 0,
		        /*[[${avgCons.AGE_16_18} ?: 0]]*/ 0
		    	];
		    const PREF_DATA   = /*[[${prefRate}]]*/ {};
		    const PREF_LABELS = Object.keys(PREF_DATA);
		    const PREF_VALUES = Object.values(PREF_DATA);
		    
		    const ACHV_DATA   = /*[[${achvPeriodRate}]]*/ {};
		    const ACHV_LABELS = Object.keys(ACHV_DATA);
		    const ACHV_VALUES = Object.values(ACHV_DATA);
		    
		    const ACHIEVED   = /*[[${achieved}]]*/ 0;
		    const UNACHIEVED = /*[[${unachieved}]]*/ 0;
		    const _sumAch    = ACHIEVED + UNACHIEVED;
		    const _achPct    = _sumAch > 0 ? Math.round((ACHIEVED / _sumAch) * 100) : 0;
		    const _unPct     = 100 - _achPct;

		    // ë²”ë¡€ ë‘ ë²ˆì§¸ ì¤„ì— ë‹¬ì„±, ë¯¸ë‹¬ì„± % ì¶œë ¥
		    const $achvSub = document.getElementById('achvLegendSub');
		    if ($achvSub) {
		      // í•„ìš”í•˜ë©´ ì¹´ìš´íŠ¸ë„ í•¨ê»˜ 
		      $achvSub.textContent = `ë‹¬ì„±: ${_achPct}% Â· ë¯¸ë‹¬ì„±: ${_unPct}%`;
		    }
		
		    const fmt = (n)=> n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
		    const displayPercent = (n) => {
		    	  if (n > 0) {
		    	    return "+" + n.toFixed(1) + "%";
		    	  } else if (n < 0) {
		    	    return n.toFixed(1) + "%"; 
		    	  } else {
		    	    return "0.0%";
		    	  }
		    	};
		    	
	    	/* ---------- ì†Œì…œ/ì¼ë°˜ ë¶„í¬(ë¶€ëª¨/ìë…€) ---------- */
			 // ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë‚´ë ¤ì£¼ëŠ” ëª¨ë¸ ê°’ ì‚¬ìš©
			 const TOT_PARENTS        = /*[[${totParents}]]*/ 0;
			 const TOT_CHILDREN       = /*[[${totChildren}]]*/ 0;
			 const TOT_PARENTS_KAKAO  = /*[[${totParents_kakao}]]*/ 0;
			 const TOT_PARENTS_NAVER  = /*[[${totParents_naver}]]*/ 0;
			 const TOT_CHILDREN_KAKAO = /*[[${totChildren_kakao}]]*/ 0;
			 const TOT_CHILDREN_NAVER = /*[[${totChildren_naver}]]*/ 0;
	
			 // ì¼ë°˜ = ì „ì²´ - (ì¹´ì¹´ì˜¤ + ë„¤ì´ë²„), ìŒìˆ˜ ë°©ì§€
			 const TOT_PARENTS_LOCAL  = Math.max(0, (TOT_PARENTS  ?? 0) - (TOT_PARENTS_KAKAO  ?? 0) - (TOT_PARENTS_NAVER  ?? 0));
			 const TOT_CHILDREN_LOCAL = Math.max(0, (TOT_CHILDREN ?? 0) - (TOT_CHILDREN_KAKAO ?? 0) - (TOT_CHILDREN_NAVER ?? 0));
	
			 // ë¼ë²¨/ì»¬ëŸ¬
			 const SIGNUP_LABELS = ['ì¹´ì¹´ì˜¤(Kakao)', 'ë„¤ì´ë²„(Naver)', 'ì¼ë°˜'];
			 const SIGNUP_COLORS = [
			   'rgba(254,229,0,0.7)',   // ì¹´ì¹´ì˜¤ ë…¸ë‘
			   'rgba(3,199,90,0.7)',    // ë„¤ì´ë²„ ì´ˆë¡
			   'rgba(143,178,255,.28)'   // ì¼ë°˜ ì—°íŒŒë‘
			 ];
	
			 // ë¶€ëª¨/ìë…€ ê°’ ë°°ì—´
			 const PARENTS_SIGNUP_VALUES = [TOT_PARENTS_KAKAO,  TOT_PARENTS_NAVER,  TOT_PARENTS_LOCAL];
			 const CHILDREN_SIGNUP_VALUES    = [TOT_CHILDREN_KAKAO, TOT_CHILDREN_NAVER, TOT_CHILDREN_LOCAL];
		    
		    /* ---------- KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ ---------- */
		    document.getElementById('kpi-total').textContent			= fmt(TOTAL_USERS);
		    document.getElementById('kpi-total-percent').textContent	= displayPercent(JOIN_PERCENT);
		    
		    document.getElementById('kpi-parents').textContent 			= fmt(PARENTS);
		    document.getElementById('kpi-parents-percent').textContent 	= displayPercent(PARENTS/(PARENTS+CHILDREN)*100);
		    document.getElementById('kpi-children').textContent    			= fmt(CHILDREN);
		    document.getElementById('kpi-children-percent').textContent    	= displayPercent(CHILDREN/(PARENTS+CHILDREN)*100);
		    
		    document.getElementById('kpi-dailyTransfers').textContent    = fmt(DAILY_TRANSFER);
		
		
		    /* ---------- ë„ë„› 4ê°œ(ë¸”ë£¨) ---------- */
		    const sumAge = AGE_VALUES.reduce((a,b)=>a+b,0);
		
		    /* ---------- ì„¸ë¡œ ë§‰ëŒ€: ìë…€ ì—°ë ¹ëŒ€(ë¸”ë£¨) ---------- */
		    new Chart(document.getElementById('chAge'), {
		      type: 'bar',
		      data: {
		        labels: AGE_LABELS,
		        datasets: [{
		          data: AGE_VALUES,
		          backgroundColor: 'rgba(62,111,239,.85)', // ë©”ì¸ ë¸”ë£¨(íˆ¬ëª…)
		          borderColor: BLUE.main,
		          borderWidth: 1,
		          borderRadius: 10,
		          maxBarThickness: 52
		        }]
		      },
		      options: {
		        responsive:true, maintainAspectRatio:false,
		        plugins: {
		          legend:{display:false},
		          tooltip:{
		            backgroundColor:'#0b1020', padding:10, titleColor:'#fff', bodyColor:'#e5e7eb',
		            callbacks:{ label:ctx => `${ctx.label}: ${fmt(ctx.parsed.y)}ëª…` }
		          }
		        },
		        scales: {
		          x: { grid:{ display:false }, ticks:{ font:{ weight:700 } } },
		          y: {
		            beginAtZero:true,
		            ticks:{ callback:(v)=>fmt(v) },
		            grid:{ color: BLUE.grid }
		          }
		        }
		      }
		    });
		    
		    /* ---------- ê°€ë¡œ ë§‰ëŒ€: ìë…€ ì—°ë ¹ë³„ ì†Œë¹„ í‰ê·  (íŒŒìŠ¤í…”~ì†”ë¦¬ë“œ ë¸”ë£¨ ë¨í”„) ---------- */
		    new Chart(document.getElementById('chAvgCons'), {
		      type: 'bar',
		      data: {
		        labels: AGE_LABELS,
		        datasets: [{
		          data: AVG_CONS_VALUES,
		          backgroundColor: RAMP_SOFT2DEEP.slice(0, AVG_CONS_VALUES.length),
		          borderColor:     [BLUE.step400, BLUE.step400, BLUE.step500, BLUE.step600, BLUE.step700],
		          borderWidth: 1,
		          borderRadius: 10,
		          maxBarThickness: 32
		        }]
		      },
		      options: {
		        indexAxis:'y',
		        responsive:true, maintainAspectRatio:false,
		        plugins: {
		          legend:{display:false},
		          tooltip:{
		            backgroundColor:'#0b1020', padding:10, titleColor:'#fff', bodyColor:'#e5e7eb',
		            callbacks:{ label: ctx => `${ctx.label}: ${fmt(ctx.parsed.x)}ì›` }
		          }
		        },
		        scales: {
		          x: {
		            beginAtZero:true,
		            ticks:{ callback:(v)=>fmt(v) + 'ì›' },
		            grid:{ color: BLUE.grid }
		          },
		          y: { grid:{ display:false }, ticks:{ font:{ weight:700 } } }
		        }
		      }
		    });
		
		    /* ---------- ë©€í‚¤ë„ë„›ê·¸ë˜í”„ : ëª©í‘œ & ê°€ì…íƒ€ì… ê´€ë ¨ ---------- */
		    multiDonutWithCenter('chPref', PREF_LABELS, PREF_VALUES, RAMP_SOFT2DEEP);
		    multiDonutWithCenter('chAchieved', ACHV_LABELS, ACHV_VALUES, RAMP_SOFT2DEEP);
			multiDonutWithCenter('chSignupParents', SIGNUP_LABELS, PARENTS_SIGNUP_VALUES, SIGNUP_COLORS);
			multiDonutWithCenter('chSignupChildren',    SIGNUP_LABELS, CHILDREN_SIGNUP_VALUES,    SIGNUP_COLORS);

		  </script>
	</main>
</body>
</html>
